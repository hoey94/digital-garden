---
{"dg-publish":true,"permalink":"/002-lean/ç®—æ³•/éšå³æ£®æ—ç®—æ³•/","dgPassFrontmatter":true}
---

# ä»€ä¹ˆæ˜¯ä¸­è½¬èˆªç­ï¼Ÿ

1.ä¸­è½¬æ—…å®¢:åœ¨æ—…è¡Œè¿‡ç¨‹ä¸­,éœ€è¦åœ¨æŸä¸ªæˆ–å¤šä¸ªä¸­è½¬ç«™ç‚¹æš‚æ—¶åœç•™,æ¢ä¹˜å…¶ä»–äº¤é€šå·¥å…·çš„æ—…å®¢ã€‚
2.ä¸­è½¬èˆªç­:æŒ‡æ—…å®¢éœ€è¦æ¢ä¹˜å…¶ä»–èˆªç­æ‰èƒ½åˆ°è¾¾ç›®çš„åœ°çš„è¿‡ç¨‹ã€‚
3.ä¸­è½¬ç«™:æŒ‡åœ¨è¿è¾“è¿‡ç¨‹ä¸­,ç”¨äºæš‚æ—¶åœç•™å’Œæ¢ä¹˜çš„ç«™ç‚¹ã€‚

>a. æ¯”å¦‚å¼ ä¸‰ï¼Œå‡æœŸåœ¨å‰ç¥¥èˆªç©ºä¹°äº†ä»åŒ—äº¬é£å¾€ä¸Šæµ·çš„ç¥¨ï¼Œä½†æ˜¯å‘ç°æ²¡æœ‰ç›´è¾¾ä¸Šæµ·çš„ç¥¨ï¼Œéœ€è¦å…ˆåˆ°æ­¦æ±‰å†åˆ°ä¸Šæµ·ï¼Œåœ¨ç¥¨é¢ä¸Šæ¥çœ‹è™½ç„¶æœ¬æ¬¡æ—…ç¨‹åˆ°äº†æ­¦æ±‰ï¼Œä½†æ˜¯ç¥¨å·åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯ç¥¨Aï¼Œå¯¹åº”çš„èˆªæ®µä¸º åŒ—äº¬-æ­¦æ±‰-ä¸Šæµ·ã€‚æˆ‘ä»¬æˆä¸ºä¸­è½¬æ—…å®¢ã€‚
  b. å†æ¯”å¦‚å¼ ä¸‰ï¼Œå‡æœŸåœ¨ä¹°äº†ä»åŒ—äº¬åˆ°ä¸Šæµ·çš„å¾€è¿”ç¥¨ï¼Œä½†æ˜¯ç¥¨å·å´æ˜¯ä¸€ä¸ªï¼Œè™½ç„¶å¾€è¿”ç¥¨çš„èµ·é£æ—¥æœŸä¸ä¸€æ ·ï¼Œä½†è¿™æ¬¡æ—…ç¨‹ä»ç„¶å±äºä¸­è½¬èˆªç¨‹ã€‚
  c.  ä¸­è½¬çš„ç«™ä¸é™åˆ¶æ¬¡æ•°ï¼Œå¯ä»¥æ— é™åˆ¶çš„ç´¯ç§¯æ¯”å¦‚å¼ ä¸‰çš„ç¥¨æ˜¯A-B-C-D-Eç­‰ç­‰ï¼Œå¯ä»¥æ— é™ä¸­è½¬æ¢ç«™ã€‚

# å¦‚ä½•èµ‹èƒ½ä¸­è½¬ï¼Ÿ

å…ˆçœ‹ä¸€ç¯‡æ–‡ç« ï¼Œ[èšç„¦æ™ºæ…§æ°‘èˆª | æ™ºæ…§èµ‹èƒ½ä¸­è½¬è¡”æ¥ï¼šæ—¶é—´çŸ­ä¸€ç‚¹ï¼Œé€Ÿåº¦å¿«ä¸€ç‚¹|æ—…å®¢|æœºåœº|å€¼æœº|èˆªå­£èˆªç­è®¡åˆ’_ç½‘æ˜“è®¢é˜… (163.com)](https://www.163.com/dy/article/IEI3UB3G0553RYPC.html)

å¥½äº†ï¼Œåˆ°åº•å’Œç®—æ³•å’Œè¿™ç©æ„å•¥å…³ç³»ï¼ŸğŸ’

ç®€å•ä¸€ç‚¹ï¼Œå°±æ˜¯åˆ©ç”¨ç®—æ³•çš„åˆ†æé¢„æµ‹æ¥è¾…åŠ©å†³ç­–ã€‚

# ç—›ç‚¹

1. ç›®å‰ä¸­è½¬æ—…å®¢çš„ç­‰å¾…å†³ç­–è¾ƒä¸ºä¸€åˆ€åˆ‡ï¼Œä¸»è¦ä»¥ä¸­è½¬æ—…å®¢äººæ•°ä½œä¸ºä¸€ä¸ªåˆ¤æ–­ä¾æ®ï¼Œå†³ç­–ç»´åº¦è¾ƒä¸ºå•ä¸€ä¸å¤Ÿå…¨é¢(æ‰©å……ä¸€äº›çº¬åº¦)
2. æ€»å€¼ç­äººæ•°è¾ƒå¤šï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„ä»·å€¼å–å‘ï¼Œå†³ç­–çš„ä»·å€¼æ ‡å‡†æ¯”è¾ƒéš¾ä»¥ç»Ÿä¸€ï¼Œæ²¡æœ‰ä¸€ä¸ªç›¸å¯¹å‚è€ƒ

# æ•°æ®å¯¼å…¥

1. ç”±ä¸šåŠ¡éƒ¨é—¨æä¾›å°½å¯èƒ½å…¨é¢çš„å†³ç­–è¯„ä¼°ç»´åº¦
2. å»ºç«‹å¤šå†³ç­–ç»´åº¦ä¸‹çš„å†³ç­–æ¡ˆä¾‹åº“ï¼Œä¾›æ¨¡å‹æ­å»º
3. é€šè¿‡æ¨¡å‹è®¡ç®—å’Œåˆ†æä¸åŒçš„å†³ç­–ç»“æœï¼Œä¸ºå†³ç­–è€…æä¾›å‡ºä¸­è½¬æ—…å®¢æ˜¯å¦ç­‰å¾…çš„å†³ç­–å»ºè®®

# å†³ç­–çŠ¶æ€

1. å·²æç½®ï¼šç»™å‡ºå†³ç­–å»ºè®®ä½†å¿½ç•¥å»¶åå¤„ç†
2. å·²ç»å¿½ç•¥ï¼šç»™å‡ºå†³ç­–å»ºè®®ä½†å¿½ç•¥
3. å¾…å¤„ç†ï¼šç»™å‡ºå†³ç­–å»ºè®®ä½†ç­‰å¾…å¤„ç†
4. æ— éœ€å¤„ç†ï¼šç»™å‡ºå†³ç­–å»ºè®®
5. å·²å¤„ç†ï¼šç»™å‡ºå†³ç­–å»ºè®®å·²å¤„ç†

# å†³ç­–ç®—æ³•

```python
# -*- coding: utf-8 -*-  
# @Time    : 2024/5/24 3:31 ä¸‹åˆ  
# @Author  : Hoey  
import json  
import os  
import pickle  
import sys  
  
import numpy as np  
import pandas as pd  
from sklearn.ensemble import RandomForestClassifier  
from sklearn.metrics import accuracy_score  
from sklearn.model_selection import train_test_split, GridSearchCV  
from sklearn.preprocessing import StandardScaler  
from argparse import ArgumentParser  
  
  
  
def parse_arguments():  
    parser = ArgumentParser()  
    parser.add_argument('json_str', help='jsonå­—ç¬¦ä¸²')  
    return parser.parse_args()  
  
  
def save_model(model_path, model):  
    with open(model_path, 'wb') as file:  
        pickle.dump(model, file)  
  
  
def get_model(model_path):  
    loaded_model = None  
    if os.path.exists(model_path):  
        with open(model_path, 'rb') as file:  
            loaded_model = pickle.load(file)  
    return loaded_model  
  
  
def read_excel_data_by_pd(file_path: str, sheet_name: str):  
    return pd.read_excel(file_path, sheet_name=sheet_name, header=0, engine='xlrd')  
  
  
def model(model_path):  
    if os.path.exists(model_path):  
        print("æ¨¡å‹å·²å­˜åœ¨")  
        return get_model(model_path)  
    else:  
        print("æ¨¡å‹ä¸å­˜åœ¨ï¼Œå¼€å§‹åˆå§‹åŒ–æ¨¡å‹..")  
        return RandomForestClassifierWrapper(model_path = model_path, random_state=100)  
  
  
class RandomForestClassifierWrapper:  
  
    def __init__(self, model_path:str, random_state: int = 100):  
  
        self.base_train_data = './assert/å†³ç­–æ ·æœ¬æ•°æ®.xls'  
        # å®šä¹‰å‚æ•°ç½‘æ ¼  
        self.param_grid = {  
            'n_estimators': [50, 100, 200],  
            'max_depth': [5, 10, 15, 20, None],  
            'min_samples_split': [2, 5, 10],  
            'min_samples_leaf': [1, 2, 4]  
        }  
  
        self.rf_clf = RandomForestClassifier(random_state=random_state)  
        self.best_rf_clf = None  
        self.scaler = StandardScaler()  
        self.init(model_path)  
  
    def init(self, model_path):  
        x, y = self.load_training_data()  
        x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3, random_state=300)  
        self.train(x_train, y_train, self.param_grid)  
        # åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹æ€§èƒ½  
        score = accuracy_score(y_test, self.predict(x_test))  
        print("æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¯„åˆ†ï¼š", score)  
        if score > 0.9:  
            save_model(model_path, self)  
  
    def load_training_data(self):  
        df = read_excel_data_by_pd(self.base_train_data, sheet_name='Sheet1')  
        x = df.iloc[:, 0:7]  
        y = df.iloc[:, -1]  
        return x, y  
  
    def train(self, x_train, y_train, param_grid):  
        X_train_scaled = self.scaler.fit_transform(x_train)  
  
        grid_search = GridSearchCV(estimator=self.rf_clf, param_grid=param_grid, cv=5)  
        grid_search.fit(X_train_scaled, y_train)  
  
        self.best_rf_clf = grid_search.best_estimator_  
  
    def predict(self, x):  
        x_scaled = self.scaler.transform(x)  
        return self.best_rf_clf.predict(x_scaled)  
  
    def predict_proba(self, x):  
        x_scaled = self.scaler.transform(x)  
        return self.best_rf_clf.predict_proba(x_scaled)  
  
  
def __test():  
    rf_model = model()  
    x_np = np.array([[35, 294000, 7000, 65, 5, 3, 423]])  
    predict_realdata_dis = rf_model.predict_proba(x_np)  
    print("é¢„æµ‹æ ·æœ¬ä¸ºæŸä¸ªæ ‡ç­¾çš„æ¦‚ç‡ï¼š\n", predict_realdata_dis)  
    predict_realdata = rf_model.predict(x_np)  
    print("é¢„æµ‹æ ·æœ¬ä¸ºæŸä¸ªæ ‡ç­¾çš„æ¦‚ç‡ï¼š\n", predict_realdata)  
  
  
if __name__ == '__main__':  
    try:  
        # pkl_file = sys.argv[1]  
        model_path = "./rf.pkl"  
        # json_str = sys.argv[2]  
        json_str = """  
[{  
"transferNumber": 35,  
"transferIncome": 294000,  
"transferCost": 7000,  
"estimateDelayTime": 65,  
"delayFlightNumber": 5,  
"flightType": 3,  
"waitAffectsNumber": 423  
}]"""
        print(json_str)  
        if not json_str:  
            raise Exception('æ— æ•ˆçš„json_str')  
  
    except Exception as e:  
        print("è¯·è¾“å…¥json_str")  
        exit(1)  
  
  
    json_data = json.loads(json_str)  
    data_list = [list(item.values()) for item in json_data]  
    x_np = np.array(data_list)  
    rf_model = model(model_path)  
    predict_realdata_dis = rf_model.predict_proba(x_np)  
    print("é¢„æµ‹æ ·æœ¬ä¸ºæŸä¸ªæ ‡ç­¾çš„æ¦‚ç‡ï¼š\n", predict_realdata_dis)  
    predict_realdata = rf_model.predict(x_np)  
    print("é¢„æµ‹æ ·æœ¬ä¸ºæŸä¸ªæ ‡ç­¾çš„æ¦‚ç‡ï¼š\n", predict_realdata)
```