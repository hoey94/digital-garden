---
{"uid":2023080322165609,"title":"Obsidian æ’ä»¶ï¼šCustomJS","tags":["è‡ªåŠ¨åŒ–","ç¼–ç¨‹","æ•ˆç‡","obsidianæ’ä»¶","readme"],"description":"å…è®¸ç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰Javascriptï¼Œä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼ŒåŒ…æ‹¬dataviewjså—å’Œtemplateræ¨¡æ¿ã€‚","author":"AI","type":"readme","draft":false,"editable":false,"modified":20230101000000,"dg-publish":true,"permalink":"/lake-of-knowledge/10-obsidian/obsidian/readme/customjs-readme/","dgPassFrontmatter":true}
---


# Obsidian æ’ä»¶ï¼šCustomJS

> [!Note] æ’ä»¶åç‰‡
> - æ’ä»¶åç§°ï¼šCustomJS
> - æ’ä»¶ä½œè€…ï¼šSam Lewis
> - æ’ä»¶è¯´æ˜ï¼šå…è®¸ç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰ Javascriptï¼Œä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼ŒåŒ…æ‹¬ dataviewjs å—å’Œ templater æ¨¡æ¿ã€‚
> - æ’ä»¶åˆ†ç±»ï¼š[' è‡ªåŠ¨åŒ– ', ' ç¼–ç¨‹ ', ' æ•ˆç‡ ', 'obsidian æ’ä»¶ ', 'readme']
> - é¡¹ç›®åœ°å€ï¼š[ç‚¹æˆ‘è®¿é—®](https://github.com/saml-dev/obsidian-custom-js)
> - å›½å†…ä¸‹è½½åœ°å€ï¼š[ä¸‹è½½å®‰è£…](https://pkmer.cn/products/plugin/pluginMarket/?customjs)

## æ¦‚è¿°

å…è®¸ç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰ Javascriptï¼Œä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼ŒåŒ…æ‹¬ dataviewjs å—å’Œ templater æ¨¡æ¿ã€‚

![CustomJS](https://cdn.pkmer.cn/covers/customjs.png!pkmer)

> [!tip] åŸæ–‡å‡ºå¤„
>
>ä¸‹é¢è‡ªè¿°æ–‡ä»¶çš„æ¥æºäº [Readme](https://ghproxy.net/https://raw.githubusercontent.com/saml-dev/obsidian-custom-js/master/README.md)
>

---

## Readme(ç¿»è¯‘ï¼‰

ä¸‹é¢æ˜¯ [[customjs\|customjs]] æ’ä»¶çš„è‡ªè¿°ç¿»è¯‘

# CustomJS

CustomJS æ˜¯ Obsidian çš„ä¸€ä¸ªæ’ä»¶ï¼Œå…è®¸ç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰çš„ Javascript ä»£ç ï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½•å¯ä»¥ç¼–å†™ JS çš„åœ°æ–¹è°ƒç”¨å®ƒï¼ŒåŒ…æ‹¬ `dataviewjs` å—å’Œ templater æ¨¡æ¿ã€‚

âœ… åœ¨æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ä¸Šéƒ½å¯ä»¥ä½¿ç”¨ï¼

## å®‰è£…

æ¨èçš„æ˜¯ï¼Œåœ¨ Obsidian ç¤¾åŒºæ’ä»¶æµè§ˆå™¨ä¸­å¯ä»¥ä½¿ç”¨ CustomJSã€‚

#### æ‰‹åŠ¨å®‰è£…

å‰å¾€ [releases](https://github.com/samlewis0602/obsidian-custom-js/releases) é¡µé¢ä¸‹è½½æœ€æ–°çš„ `main.js` å’Œ `manifest.json` æ–‡ä»¶ã€‚åœ¨ `.obsidian/plugins` æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªåä¸º `customjs` çš„æ–‡ä»¶å¤¹ï¼Œå¹¶å°†è¿™ä¸¤ä¸ªæ–‡ä»¶æ”¾å…¥å…¶ä¸­ã€‚

## è®¾ç½®

å‘Šè¯‰ CustomJS åŠ è½½ä»€ä¹ˆä»£ç ã€‚

æ³¨æ„ï¼šåœ¨è·¯å¾„ä¸­åªä½¿ç”¨æ­£æ–œæ ï¼Œåæ–œæ ä¼šç ´åé Windows å¹³å°ã€‚

### å•ä¸ªæ–‡ä»¶

ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„æ–‡ä»¶åˆ—è¡¨ï¼Œæ‚¨æƒ³è¦åŠ è½½çš„æ–‡ä»¶ã€‚

### æ–‡ä»¶å¤¹

æŒ‡å‘åŒ…å«æ‚¨æƒ³è¦åŠ è½½çš„ JS æ–‡ä»¶çš„æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚æ–‡ä»¶å¤¹è®¾ç½®å°†é€’å½’åœ°åŠ è½½è¯¥æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰ `*.js` æ–‡ä»¶ã€‚å› æ­¤ï¼Œè®¾ç½® `scripts` å°†åŠ è½½ `scripts/a.js` å’Œ `scripts/other/b.js`ã€‚

> âš ï¸ ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œæ–‡ä»¶æŒ‰ç…§***æ–‡ä»¶å***çš„å­—æ¯é¡ºåºåŠ è½½ï¼Œä»¥ä¾¿å½¼æ­¤ä¹‹é—´å¯ä»¥æœ‰ä¾èµ–å…³ç³»ã€‚

### æ³¨å†Œå¯è°ƒç”¨è„šæœ¬

å…è®¸æ‚¨å°† [å¯è°ƒç”¨è„šæœ¬](#invocable-scripts) ç»‘å®šåˆ°çƒ­é”®ã€‚

### å¯åŠ¨è„šæœ¬

åœ¨æ’ä»¶åŠ è½½æ—¶æ‰§è¡Œçš„ [å¯è°ƒç”¨è„šæœ¬](#invocable-scripts)ã€‚æ‚¨å¯ä»¥åœ¨ Obsidian åŠ è½½æ—¶ä½¿ç”¨å®ƒæ¥åˆå§‹åŒ–ä¸€äº›å†…å®¹ã€‚

> âš ï¸ åœ¨â€œå¯åŠ¨è„šæœ¬â€ä¸­å¯¹â€œwindow.customJSâ€å¯¹è±¡æ‰€åšçš„æ›´æ”¹å¯èƒ½ä¼šè¢«è¦†ç›–ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè¯·éµå¾ª [çŠ¶æ€](#state) æç¤ºã€‚

## ç”¨æ³•/ç¤ºä¾‹

CustomJS é€šè¿‡ç¼–å†™ JavaScript ç±»æ¥å·¥ä½œã€‚æ¯ä¸ªæ–‡ä»¶åªèƒ½åŒ…å«ä¸€ä¸ªç±»ã€‚

````
// åœ¨scripts/coolString.jsä¸­çš„vaultä¸­
class CoolString {
    coolify(s) {
        return `ğŸ˜ ${s} ğŸ˜`
    }
}


// *.mdä¸­çš„dataviewjså—
<pre class="dataview dataview-error">Dataview JS queries are disabled. You can enable them in the Dataview settings.</pre>

// templateræ¨¡æ¿
<%*
const {CoolString} = customJS;
tR += CoolString.coolify(tp.file.title);
%>
````

ç¡®ä¿å°† `scripts/coolString.js` æ·»åŠ åˆ° CustomJS çš„è®¾ç½®é¡µé¢ï¼Œå®Œæˆï¼å½“è¿›å…¥ dataviewjs å—çš„é¢„è§ˆæ¨¡å¼æ—¶ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°æ‰€æœ‰æ–‡ä»¶çš„åˆ—è¡¨ï¼Œå¸¦æœ‰é¢å¤–çš„ğŸ˜ - æ’å…¥ templater æ¨¡æ¿å°†è¾“å‡ºç±»ä¼¼çš„ç»“æœï¼Œåªæ˜¾ç¤ºå½“å‰æ–‡ä»¶åã€‚

## é«˜çº§ç¤ºä¾‹

æ‚¨å¯ä»¥å°†ä»»ä½•å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œä»¥å®ç°ä¸€äº›ä»¤äººéš¾ä»¥ç½®ä¿¡çš„ä»£ç é‡ç”¨ã€‚ä»¥ä¸‹æ˜¯æˆ‘ç”¨æ¥ç®¡ç†ä»»åŠ¡çš„ dataview ç¤ºä¾‹ï¼š

#### æ¯æ—¥ç¬”è®°

````
<pre class="dataview dataview-error">Dataview JS queries are disabled. You can enable them in the Dataview settings.</pre>

<pre class="dataview dataview-error">Dataview JS queries are disabled. You can enable them in the Dataview settings.</pre>

### ä»Šå¤©çš„ä»»åŠ¡
<pre class="dataview dataview-error">Dataview JS queries are disabled. You can enable them in the Dataview settings.</pre>

### æ¯æ—¥æ—¥è®°

```
class DvTasks {
  relDateString(d, luxon) {
    if (!(d instanceof luxon.DateTime)) return 'â€“'
    const now = luxon.DateTime.now()
    const days = Math.ceil(d.diff(now, 'days').days)
    if (days < 0) return 'é€¾æœŸ ' + d.toFormat('L/d')
    if (days === 0) return 'ä»Šå¤©'
    if (days === 1) return 'æ˜å¤©'
    if (days < 7) return d.toFormat('cccc')
    return d.toFormat('ccc L/d')
  }

  getButtonStrings(status) {
    const completed = status === 'Completed'
    const btnStr = completed ? 'æ’¤é”€' : 'å®Œæˆ'
    const updateStr = completed ? 'å¾…åŠ' : 'å·²å®Œæˆ'
    return { btnStr, updateStr }
  }

  getCustomLink(name, target) {
    return `[[${target}|${name}]]`
  }

  getTodayTasks(args) {
    const { luxon, dv, date, that } = args
    const finalDate = date ?? dv.current().file.name
    return this.getTasksTable({
      ...args,
      filterFn: t => t.status != 'Completed' && t.dueDate && t.dueDate?.hasSame(luxon.DateTime.fromISO(finalDate), 'day')
    })
  }

  getOverdueTasks(args) {
    const { luxon, dv, date, that } = args
    const finalDate = date ?? dv.current().file.name
    return this.getTasksTable({
      ...args,
      prependText: 'é€¾æœŸ',
      filterFn: t => t.dueDate && t.dueDate < luxon.DateTime.fromISO(finalDate) && t.status != 'Completed'
    })
  }

  getTasksNoDueDate(args) {
    return this.getTasksTable({
      ...args,
      prependText: 'æ— æˆªæ­¢æ—¥æœŸ',
      filterFn: t => !t.dueDate
    })
  }

  getTasksTable(args) {
    const {
      that,
      app,
      dv,
      luxon,
      getSortProp = t => t.dueDate,
      sortOrder = 'asc',
      filterFn = t => t.task,
      completedCol = false,
      prependHeaderLevel = 3,
      prependText
    } = args;
    const { metaedit, buttons } = app.plugins.plugins
    const { update } = metaedit.api
    const { createButton } = buttons


    const dueStr = completedCol ? 'å·²å®Œæˆ' : 'æˆªæ­¢æ—¥æœŸ';
    const pages = dv.pages("#task").sort(getSortProp, sortOrder).where(filterFn)
    if (pages.length === 0) {
      // console.log('Empty dataview:', args)
      return
    }

    if (prependText) {
      dv.header(prependHeaderLevel, prependText)
    }

    dv.table(["åç§°", "ç±»åˆ«", dueStr, "", ""], pages
      .map(t => {
        const { btnStr, updateStr } = this.getButtonStrings(t.status)
        return [
          this.getCustomLink(t.task, t.file.name),
          t.category,
          this.relDateString(t.dueDate, luxon),
          createButton({
            app,
            el: that.container,
            args: { name: btnStr },
            clickOverride: { click: update, params: ['çŠ¶æ€', updateStr, t.file.path] }
          }),
        ]
      })
    )
  }
}
```

#### ç»“æœ
![ç»“æœ](images/dvTasksExample.png)

### å¼‚æ­¥ä½¿ç”¨

CustomJSé€šè¿‡æŒ‚é’©ä¸€ä¸ªäº‹ä»¶æ¥åœ¨Obsidianå¯åŠ¨æ—¶åŠ è½½æ‚¨çš„æ¨¡å—ï¼Œè¯¥äº‹ä»¶è¡¨ç¤ºObsidianå·²å‡†å¤‡å°±ç»ªã€‚è¿™æ˜¯å…¶ä»–æ’ä»¶ï¼ˆå¦‚[Templater](https://github.com/SilentVoid13/Templater)åŠå…¶å¯åŠ¨æ¨¡æ¿ï¼‰ä¹Ÿä½¿ç”¨çš„äº‹ä»¶ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™æ„å‘³ç€å¦‚æœæ‚¨æƒ³ä¸å®ƒä»¬ä¸€èµ·ä½¿ç”¨CustomJSï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚

> `customJS`æœªå®šä¹‰

å¦‚æœæ‚¨å‘ç°`customJS`å˜é‡æœªå®šä¹‰ï¼Œè¿™æ„å‘³ç€æ‚¨å¸Œæœ›åœ¨è„šæœ¬ç»§ç»­æ‰§è¡Œä¹‹å‰å¼ºåˆ¶åŠ è½½å®ƒã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æä¾›äº†å¼‚æ­¥å‡½æ•°`forceLoadCustomJS()`ï¼Œå®ƒä¹Ÿåœ¨å…¨å±€èŒƒå›´å†…å®šä¹‰ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨`await`æ¥ç¡®ä¿åœ¨éœ€è¦æ—¶`customJS`å°†å¯ç”¨ã€‚

```js
await forceLoadCustomJS();
```

è¯è™½å¦‚æ­¤ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ___æ‚¨ä¸éœ€è¦è¿™æ ·åš___ã€‚åœ¨Obsidianä¸­è¿›è¡Œçš„ç»å¤§å¤šæ•°JavaScriptæ‰§è¡Œä¸­ï¼ŒcustomJSå°†è¢«åŠ è½½ã€‚

### å¯è°ƒç”¨è„šæœ¬

*å¯è°ƒç”¨è„šæœ¬* æ˜¯å…·æœ‰å®šä¹‰æ–¹æ³•çš„ç±»

```js
async invoke() {
  ...
}
```

æ‚¨å¯ä»¥é€šè¿‡`CustomJS: Invoke Script`å‘½ä»¤è¿è¡Œæ­¤ç±»è„šæœ¬ã€‚

æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡[è®¾ç½®](#registered-invocable-scripts)ä¸ºæ‰€éœ€çš„è„šæœ¬æ³¨å†Œå•ç‹¬çš„å‘½ä»¤ï¼Œå¹¶é€šè¿‡`CustomJS: MyScriptName`å‘½ä»¤è°ƒç”¨å®ƒã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä¸ºè¿™äº›å·²æ³¨å†Œçš„å‘½ä»¤åˆ†é…è‡ªå®šä¹‰çƒ­é”®ã€‚

### çŠ¶æ€

æ¯å½“åœ¨ä¿é™©åº“ä¸­ä¿®æ”¹ä»»ä½•`js`æ–‡ä»¶æ—¶ï¼Œ`window.customJS`å¯¹è±¡éƒ½ä¼šè¢«è¦†ç›–ã€‚å¦‚æœæ‚¨éœ€è¦åœ¨è¿™äº›ä¿®æ”¹æœŸé—´ä¿ç•™ä¸€äº›æ•°æ®ï¼Œè¯·å°†å®ƒä»¬å­˜å‚¨åœ¨`window.customJS.state`ä¸­ã€‚

## â˜•ï¸ æ”¯æŒ
æ‚¨è§‰å¾—CustomJSæœ‰ç”¨å—ï¼Ÿè€ƒè™‘ç»™æˆ‘ä¹°æ¯å’–å•¡æ¥æ”¯æŒæ›´æ–°å’Œå¼€å‘æ›´å¤šç±»ä¼¼çš„æœ‰ç”¨è½¯ä»¶ã€‚è°¢è°¢ï¼





